package dxl_communication;

import java.awt.List;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import java_native_access.IDynamixelControl;


/*
 * 
 * The methods in this class are used for communication between the computer and the Dynamixel actuator(s).
 * The methods are called from the 
 * 
 * 
 * TODO create a dictionary that contains the control table!
 * 
 * 
 */
public class Communication {
	
	private static int DEFAULT_PORTNUM = 3; //com3
	private static int DEFAULT_BAUDNUM = 1; //mbps	
	
	
	// Addresses that can not be read as words:
	public final static int[] singleByteAddresses = {2, 3, 4, 5, 11, 12, 13, 16, 17, 18, 24, 25, 26, 27, 28, 29, 42, 43, 44, 46, 47};
	
	/**
	 * Checks whether this address contains a value that consists of a single byte
	 * @param actuator address to check
	 */
	public static boolean isSingleByteAddress(int address){
		
		boolean isSingle = false;
		for(int i = 0; i < singleByteAddresses.length; ++i){
			if(singleByteAddresses[i] == address)
			{
				isSingle = true;
				break;
			}
		}

		return isSingle;
	}
	
	// Dictionary containing the control table. Key is parameter name, value is address.
	static Map<String, Integer> controlTableDictionary = new HashMap<String, Integer>();
	static{ // dictionary entries: 
		
		
		controlTableDictionary.put("model number(l)", 0);
		controlTableDictionary.put("model number(h)", 1);
		controlTableDictionary.put("version of firmware", 2);
		controlTableDictionary.put("id", 3);
		controlTableDictionary.put("baud rate", 4);
		controlTableDictionary.put("return delay time", 5);
		controlTableDictionary.put("cw angle limit(l)", 6);
		controlTableDictionary.put("cw angle limit(h)", 7);
		controlTableDictionary.put("ccw angle limit(l)", 8);
		controlTableDictionary.put("ccw angle limit(h)", 9);
		controlTableDictionary.put("the highest limit temperature", 11);
		controlTableDictionary.put("the lowest limit voltage", 12);
		controlTableDictionary.put("the highest limit voltage", 13);
		controlTableDictionary.put("max torque(l)", 14);
		controlTableDictionary.put("max torque(h)", 15);
		controlTableDictionary.put("status return level", 16);
		controlTableDictionary.put("alarm led", 17);
		controlTableDictionary.put("alarm shutdown", 18);
		controlTableDictionary.put("torque enable", 24);
		controlTableDictionary.put("led", 25);
		controlTableDictionary.put("cw compliance margin", 26);
		controlTableDictionary.put("ccw compliance margin", 27);
		controlTableDictionary.put("cw compliance slope", 28);
		controlTableDictionary.put("ccw compliance slope", 29);
		controlTableDictionary.put("goal position(l)", 30);
		controlTableDictionary.put("goal position(h)", 31);
		controlTableDictionary.put("moving speed(l)", 32);
		controlTableDictionary.put("moving speed(h)", 33);
		controlTableDictionary.put("torque limit(l)", 34);
		controlTableDictionary.put("torque limit(h)", 35);
		controlTableDictionary.put("present position(l)", 36);
		controlTableDictionary.put("present position(h)", 37);
		controlTableDictionary.put("present speed(l)", 38);
		controlTableDictionary.put("present speed(h)", 39);
		controlTableDictionary.put("present load(l)", 40);
		controlTableDictionary.put("present load(h)", 41);
		controlTableDictionary.put("present voltage", 42);
		controlTableDictionary.put("present temperature", 43);
		controlTableDictionary.put("registered", 44);
		controlTableDictionary.put("moving)", 46);
		controlTableDictionary.put("lock", 47);
		controlTableDictionary.put("punch(l)", 48);
		controlTableDictionary.put("punch(h)", 49);
	}

	public int getModelNumber(int id){
		readFromDxl(id, )
	}
	
	
	/**
	 * 
	 * @return
	 */
	public static int initialize()	{
		return IDynamixelControl.INSTANCE.dxl_initialize(DEFAULT_PORTNUM, DEFAULT_BAUDNUM);
	}
	/**
	 * 
	 */
	public static void terminate() {
		IDynamixelControl.INSTANCE.dxl_terminate();
	}
	
	/* NOT SURE IF NEEDED HERE
	public static void tx_packet() {
		IDynamixelControl.INSTANCE.dxl_tx_packet();
	}
	
	public static void rx_packet() {
		IDynamixelControl.INSTANCE.dxl_rx_packet();
	}
	*/
	

	
	
	/**
	 * This should automatically choose between byte and word
	 * 
	 * @return
	 */
	public static int readFromDxl(int id, int address){
		if(isSingleByteAddress(address)) return readByteFromDxl(id, address);
		else return readWordFromDxl(id, address);
	}
	
	/**
	 * This should automatically choose between byte and word
	 */
	public static void writeToDxl(int id, int address,int value){
		if(isSingleByteAddress(address)) writeByteToDxl(id, address, value);
		else writeWordToDxl(id, address, value);
		
	}
	
	private static void writeByteToDxl(int id, int address, int value){
		IDynamixelControl.INSTANCE.dxl_write_byte(id, address, value);
	}
	
	private static void writeWordToDxl(int id, int address, int value){
		IDynamixelControl.INSTANCE.dxl_write_word(id, address, value);
	}
	
	private static int readByteFromDxl(int id, int address){
		return IDynamixelControl.INSTANCE.dxl_read_byte(id, address);
	}
	
	private static int readWordFromDxl(int id, int address){
		return IDynamixelControl.INSTANCE.dxl_read_word(id, address);
	}
	
	

}
